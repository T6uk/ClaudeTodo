{% extends 'base.html' %}

{% block title %}Daily Events - TaskMaster App{% endblock %}

{% block content %}
<div class="page-title">
    <h1>Daily Events</h1>
    <a href="{{ url_for('main.create_event', date=current_date.strftime('%Y-%m-%d')) }}" class="btn btn-primary">Create Event</a>
</div>

<div class="calendar-container">
    <div class="calendar-header">
        <div class="calendar-nav">
            <a href="{{ url_for('main.events', view='day', date=(current_date - timedelta(days=1)).strftime('%Y-%m-%d')) }}" class="btn btn-secondary btn-icon">
                <i>◀</i>
            </a>
            <div class="calendar-title">
                {{ current_date.strftime('%A, %d %B %Y') }}
            </div>
            <a href="{{ url_for('main.events', view='day', date=(current_date + timedelta(days=1)).strftime('%Y-%m-%d')) }}" class="btn btn-secondary btn-icon">
                <i>▶</i>
            </a>
        </div>
        <div class="calendar-views">
            <a href="{{ url_for('main.events', view='month', date=current_date.strftime('%Y-%m-%d')) }}" class="view-btn">Month</a>
            <a href="{{ url_for('main.events', view='week', date=current_date.strftime('%Y-%m-%d')) }}" class="view-btn">Week</a>
            <a href="{{ url_for('main.events', view='day', date=current_date.strftime('%Y-%m-%d')) }}" class="view-btn active">Day</a>
        </div>
    </div>

    <div class="day-schedule">
        <!-- All-day events section -->
        {% set has_all_day_events = false %}
        {% for event in events %}
            {% if event.all_day %}
                {% if not has_all_day_events %}
                    {% set has_all_day_events = true %}
                    <div class="all-day-events">
                        <div class="all-day-label">All Day Events</div>
                {% endif %}
                <a href="{{ url_for('main.event_detail', id=event.id) }}" class="day-event event-{{ event.color }}">
                    {{ event.title }}
                </a>
            {% endif %}
        {% endfor %}
        {% if has_all_day_events %}
            </div>
        {% endif %}

        <!-- Hourly events -->
        {% set current_time = now() %}
        {% for hour in range(8, 21) %}
        <div class="time-slot">
            <div class="time-label">{{ hour }}:00</div>
            <div class="time-events">
                {% if current_date == today and current_time.hour == hour %}
                <div class="current-time-marker" style="top: {{ (current_time.minute / 60) * 100 }}%;"></div>
                {% endif %}

                {% for event in events %}
                    {% if not event.all_day and event.start_datetime.hour == hour %}
                    <a href="{{ url_for('main.event_detail', id=event.id) }}" class="day-event event-{{ event.color }}">
                        {{ event.start_datetime.strftime('%H:%M') }} - {{ event.title }}
                    </a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        {% if events|length == 0 %}
        <div class="empty-day-message">No events scheduled for this day</div>
        {% endif %}
    </div>
</div>
{% endblock %}