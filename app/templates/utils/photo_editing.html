<!-- app/templates/utils/photo_editing.html -->
{% extends "base.html" %}

{% block head %}
<style>
    .photo-tool-card {
        transition: all 0.3s;
        cursor: pointer;
        height: 100%;
    }

    .photo-tool-card:hover {
        transform: translateY(-5px);
    }

    .photo-editor {
        background-color: var(--card-bg);
        border-radius: 15px;
        box-shadow: var(--card-shadow);
        padding: 1.5rem;
        margin-top: 1.5rem;
    }

    .image-preview-container {
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px dashed #ccc;
        border-radius: 10px;
        margin-bottom: 1rem;
        padding: 1rem;
        position: relative;
    }

    [data-bs-theme="dark"] .image-preview-container {
        border-color: #555;
    }

    .image-preview {
        max-width: 100%;
        max-height: 400px;
    }

    .drop-zone {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.05);
        z-index: 5;
        border-radius: 10px;
    }

    [data-bs-theme="dark"] .drop-zone {
        background-color: rgba(255, 255, 255, 0.05);
    }

    .drop-zone.active {
        background-color: rgba(var(--primary-rgb), 0.1);
        border: 2px dashed var(--primary);
    }

    .preview-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1rem;
    }

    .tool-controls {
        margin-top: 1rem;
    }

    .dimension-inputs {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .dimension-group {
        flex: 1;
    }

    .image-result {
        margin-top: 2rem;
        display: none;
    }

    .result-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 1rem;
    }

    .filter-preview {
        width: 120px;
        height: 90px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        border: 2px solid transparent;
        transition: all 0.2s;
        cursor: pointer;
    }

    .filter-preview:hover, .filter-preview.active {
        border-color: var(--primary);
        transform: scale(1.05);
    }

    .filter-name {
        font-size: 0.8rem;
        text-align: center;
    }

    .filter-option {
        margin-bottom: 1rem;
    }

    .cropper-container {
        position: relative;
        max-width: 100%;
        margin: 0 auto;
    }

    .cropper-overlay {
        position: absolute;
        border: 2px dashed white;
        box-shadow: 0 0 0 99999px rgba(0, 0, 0, 0.5);
        top: 25%;
        left: 25%;
        width: 50%;
        height: 50%;
        cursor: move;
        z-index: 10;
    }

    .resize-handle {
        position: absolute;
        width: 10px;
        height: 10px;
        background: white;
        border: 1px solid #333;
    }

    .resize-handle-nw {
        top: -5px;
        left: -5px;
        cursor: nw-resize;
    }

    .resize-handle-ne {
        top: -5px;
        right: -5px;
        cursor: ne-resize;
    }

    .resize-handle-sw {
        bottom: -5px;
        left: -5px;
        cursor: sw-resize;
    }

    .resize-handle-se {
        bottom: -5px;
        right: -5px;
        cursor: se-resize;
    }

    .adjustment-slider {
        width: 100%;
    }

    .rotate-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .rotate-action {
        flex: 1;
        text-align: center;
    }

    .rotate-icon {
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .rotate-icon:hover {
        color: var(--primary);
        transform: scale(1.2);
    }

    .angle-input {
        width: 5rem;
        text-align: center;
    }

    .tool-selector {
        text-align: center;
        margin-bottom: 2rem;
    }

    .tool-btn {
        margin: 0 0.5rem;
    }

    .section-title {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }

    .section-title i {
        margin-right: 0.5rem;
    }

    .editor-tab {
        display: none;
    }

    .editor-tab.active {
        display: block;
    }

    .grid-overlay-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 5;
    }

    .grid-line {
        position: absolute;
        background-color: rgba(255, 255, 255, 0.7);
    }

    .grid-line-horizontal {
        width: 100%;
        height: 1px;
    }

    .grid-line-vertical {
        height: 100%;
        width: 1px;
    }

    .grid-buttons {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h1>
                <i class="fas fa-image me-2"></i>
                Photo Editing
            </h1>
            <p class="lead">Edit and transform your photos with our easy-to-use tools</p>
        </div>
    </div>

    <div class="photo-editor">
        <div class="image-preview-container" id="upload-container">
            <div class="drop-zone" id="drop-zone">
                <div class="text-center">
                    <i class="fas fa-cloud-upload-alt fa-3x mb-3"></i>
                    <p>Drag & drop your image here or click to browse</p>
                    <input type="file" id="image-upload" class="d-none" accept=".jpg,.jpeg,.png,.gif">
                    <button class="btn btn-primary" id="browse-btn">
                        <i class="fas fa-folder-open me-2"></i>
                        Browse Files
                    </button>
                </div>
            </div>
            <img id="image-preview" class="image-preview d-none" alt="Preview">
        </div>

        <div class="preview-actions d-none" id="preview-actions">
            <button class="btn btn-secondary" id="change-image-btn">
                <i class="fas fa-exchange-alt me-2"></i>
                Change Image
            </button>
            <button class="btn btn-danger" id="remove-image-btn">
                <i class="fas fa-trash me-2"></i>
                Remove Image
            </button>
        </div>

        <!-- Tool Selector Tabs -->
        <div class="tool-selector d-none" id="tool-selector">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary tool-btn" data-tool="scaling">
                    <i class="fas fa-compress-arrows-alt"></i> Resize
                </button>
                <button type="button" class="btn btn-outline-primary tool-btn" data-tool="rotation">
                    <i class="fas fa-sync-alt"></i> Rotate
                </button>
                <button type="button" class="btn btn-outline-primary tool-btn" data-tool="crop">
                    <i class="fas fa-crop-alt"></i> Crop
                </button>
                <button type="button" class="btn btn-outline-primary tool-btn" data-tool="filter">
                    <i class="fas fa-adjust"></i> Filters
                </button>
                <button type="button" class="btn btn-outline-primary tool-btn" data-tool="adjust">
                    <i class="fas fa-sliders-h"></i> Adjust
                </button>
                <button type="button" class="btn btn-outline-primary tool-btn" data-tool="grid">
                    <i class="fas fa-th"></i> Grid
                </button>
                <button type="button" class="btn btn-outline-primary tool-btn" data-tool="watermark">
                    <i class="fas fa-copyright"></i> Watermark
                </button>
            </div>
        </div>

        <!-- Resize Controls -->
        <div class="tool-controls editor-tab" id="scaling-controls">
            <div class="section-title">
                <i class="fas fa-compress-arrows-alt"></i>
                <h3 class="h5 mb-0">Resize Image</h3>
            </div>

            <div class="dimension-inputs">
                <div class="dimension-group">
                    <label for="width-input" class="form-label">Width (pixels)</label>
                    <input type="number" class="form-control" id="width-input" min="1" placeholder="Width">
                </div>
                <div class="dimension-group">
                    <label for="height-input" class="form-label">Height (pixels)</label>
                    <input type="number" class="form-control" id="height-input" min="1" placeholder="Height">
                </div>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="maintain-aspect" checked>
                <label class="form-check-label" for="maintain-aspect">
                    Maintain aspect ratio
                </label>
            </div>

            <div class="d-grid">
                <button class="btn btn-primary" id="scale-btn">
                    <i class="fas fa-compress-arrows-alt me-2"></i>
                    Resize Image
                </button>
            </div>
        </div>

        <!-- Rotation Controls -->
        <div class="tool-controls editor-tab" id="rotation-controls">
            <div class="section-title">
                <i class="fas fa-sync-alt"></i>
                <h3 class="h5 mb-0">Rotate Image</h3>
            </div>

            <div class="rotate-controls">
                <div class="rotate-action">
                    <i class="fas fa-undo rotate-icon" id="rotate-left"></i>
                    <p>90° Left</p>
                </div>
                <div class="rotate-action">
                    <i class="fas fa-redo rotate-icon" id="rotate-right"></i>
                    <p>90° Right</p>
                </div>
                <div class="rotate-action">
                    <i class="fas fa-arrows-alt-h rotate-icon" id="flip-horizontal"></i>
                    <p>Flip Horizontal</p>
                </div>
                <div class="rotate-action">
                    <i class="fas fa-arrows-alt-v rotate-icon" id="flip-vertical"></i>
                    <p>Flip Vertical</p>
                </div>
            </div>

            <div class="mb-3">
                <label for="angle-input" class="form-label">Custom Angle (degrees)</label>
                <div class="d-flex align-items-center">
                    <input type="number" class="form-control angle-input me-3" id="angle-input" value="0" min="-180" max="180" step="1">
                    <input type="range" class="form-range flex-grow-1" id="angle-slider" min="-180" max="180" value="0" step="1">
                </div>
            </div>

            <div class="d-grid">
                <button class="btn btn-primary" id="rotate-btn">
                    <i class="fas fa-sync-alt me-2"></i>
                    Apply Rotation
                </button>
            </div>
        </div>

        <!-- Crop Controls -->
        <div class="tool-controls editor-tab" id="crop-controls">
            <div class="section-title">
                <i class="fas fa-crop-alt"></i>
                <h3 class="h5 mb-0">Crop Image</h3>
            </div>

            <div class="mb-3">
                <p>Drag the handles to adjust the crop area</p>
                <div class="cropper-container" id="cropper-container">
                    <img id="crop-preview" class="image-preview w-100" alt="Crop Preview">
                    <div class="cropper-overlay" id="crop-overlay">
                        <div class="resize-handle resize-handle-nw" id="handle-nw"></div>
                        <div class="resize-handle resize-handle-ne" id="handle-ne"></div>
                        <div class="resize-handle resize-handle-sw" id="handle-sw"></div>
                        <div class="resize-handle resize-handle-se" id="handle-se"></div>
                    </div>
                </div>
            </div>

            <div class="d-grid">
                <button class="btn btn-primary" id="crop-btn">
                    <i class="fas fa-crop-alt me-2"></i>
                    Apply Crop
                </button>
            </div>
        </div>

        <!-- Filter Controls -->
        <div class="tool-controls editor-tab" id="filter-controls">
            <div class="section-title">
                <i class="fas fa-adjust"></i>
                <h3 class="h5 mb-0">Apply Filters</h3>
            </div>

            <div class="row" id="filter-previews">
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview active" data-filter="none" src="" alt="Original">
                    <p class="filter-name">Original</p>
                </div>
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview" data-filter="grayscale" src="" alt="Grayscale">
                    <p class="filter-name">Grayscale</p>
                </div>
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview" data-filter="sepia" src="" alt="Sepia">
                    <p class="filter-name">Sepia</p>
                </div>
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview" data-filter="blur" src="" alt="Blur">
                    <p class="filter-name">Blur</p>
                </div>
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview" data-filter="sharpen" src="" alt="Sharpen">
                    <p class="filter-name">Sharpen</p>
                </div>
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview" data-filter="emboss" src="" alt="Emboss">
                    <p class="filter-name">Emboss</p>
                </div>
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview" data-filter="edge_enhance" src="" alt="Edge Enhance">
                    <p class="filter-name">Edge Enhance</p>
                </div>
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview" data-filter="contour" src="" alt="Contour">
                    <p class="filter-name">Contour</p>
                </div>
                <div class="col-4 col-md-2 filter-option">
                    <img class="filter-preview" data-filter="smooth" src="" alt="Smooth">
                    <p class="filter-name">Smooth</p>
                </div>
            </div>

            <div class="d-grid mt-3">
                <button class="btn btn-primary" id="filter-btn">
                    <i class="fas fa-adjust me-2"></i>
                    Apply Filter
                </button>
            </div>
        </div>

        <!-- Adjustment Controls -->
        <div class="tool-controls editor-tab" id="adjust-controls">
            <div class="section-title">
                <i class="fas fa-sliders-h"></i>
                <h3 class="h5 mb-0">Adjust Image</h3>
            </div>

            <div class="mb-3">
                <label for="brightness-slider" class="form-label">Brightness</label>
                <div class="d-flex align-items-center">
                    <input type="range" class="form-range adjustment-slider" id="brightness-slider" min="0" max="2" value="1" step="0.05">
                    <span class="ms-2" id="brightness-value">1.0</span>
                </div>
            </div>

            <div class="mb-3">
                <label for="contrast-slider" class="form-label">Contrast</label>
                <div class="d-flex align-items-center">
                    <input type="range" class="form-range adjustment-slider" id="contrast-slider" min="0" max="2" value="1" step="0.05">
                    <span class="ms-2" id="contrast-value">1.0</span>
                </div>
            </div>

            <div class="mb-3">
                <label for="saturation-slider" class="form-label">Saturation</label>
                <div class="d-flex align-items-center">
                    <input type="range" class="form-range adjustment-slider" id="saturation-slider" min="0" max="2" value="1" step="0.05">
                    <span class="ms-2" id="saturation-value">1.0</span>
                </div>
            </div>

            <div class="mb-3">
                <label for="sharpness-slider" class="form-label">Sharpness</label>
                <div class="d-flex align-items-center">
                    <input type="range" class="form-range adjustment-slider" id="sharpness-slider" min="0" max="2" value="1" step="0.05">
                    <span class="ms-2" id="sharpness-value">1.0</span>
                </div>
            </div>

            <div class="d-grid">
                <button class="btn btn-primary" id="adjust-btn">
                    <i class="fas fa-sliders-h me-2"></i>
                    Apply Adjustments
                </button>
            </div>
        </div>

        <!-- Grid Controls -->
        <div class="tool-controls editor-tab" id="grid-controls">
            <div class="grid-buttons">
                <div class="section-title">
                    <i class="fas fa-th"></i>
                    <h3 class="h5 mb-0">Add Grid Overlay</h3>
                </div>
                <button class="btn btn-success" id="download-grid-btn">
                    <i class="fas fa-download me-2"></i> Download with Grid
                </button>
            </div>

            <div class="mb-3">
                <label for="grid-type" class="form-label">Grid Type</label>
                <select class="form-select" id="grid-type">
                    <option value="rule-of-thirds">Rule of Thirds</option>
                    <option value="golden-ratio">Golden Ratio</option>
                    <option value="custom">Custom Grid</option>
                </select>
            </div>

            <div id="custom-grid-options" class="mb-3" style="display: none;">
                <div class="row mb-2">
                    <div class="col-6">
                        <label for="grid-columns" class="form-label">Columns</label>
                        <input type="number" class="form-control" id="grid-columns" min="1" max="20" value="3">
                    </div>
                    <div class="col-6">
                        <label for="grid-rows" class="form-label">Rows</label>
                        <input type="number" class="form-control" id="grid-rows" min="1" max="20" value="3">
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label for="grid-color" class="form-label">Grid Color</label>
                <input type="color" class="form-control form-control-color" id="grid-color" value="#ffffff">
            </div>

            <div class="mb-3">
                <label for="grid-opacity" class="form-label">Grid Opacity</label>
                <div class="d-flex align-items-center">
                    <input type="range" class="form-range" id="grid-opacity" min="0.1" max="1" step="0.1" value="0.7">
                    <span class="ms-2" id="grid-opacity-value">0.7</span>
                </div>
            </div>

            <div class="mb-3">
                <label for="grid-thickness" class="form-label">Grid Line Thickness</label>
                <div class="d-flex align-items-center">
                    <input type="range" class="form-range" id="grid-thickness" min="1" max="5" step="1" value="1">
                    <span class="ms-2" id="grid-thickness-value">1px</span>
                </div>
            </div>

            <div class="d-grid gap-2">
                <button class="btn btn-primary" id="apply-grid-btn">
                    <i class="fas fa-th me-2"></i> Apply Grid
                </button>
                <button class="btn btn-outline-secondary" id="remove-grid-btn">
                    <i class="fas fa-eraser me-2"></i> Remove Grid
                </button>
            </div>
        </div>

        <div class="tool-controls editor-tab" id="watermark-controls">
    <div class="section-title">
        <i class="fas fa-copyright"></i>
        <h3 class="h5 mb-0">Add Watermark</h3>
    </div>

    <div class="mb-3">
        <label for="watermark-text" class="form-label">Watermark Text</label>
        <input type="text" class="form-control" id="watermark-text" placeholder="Enter watermark text">
    </div>

    <div class="mb-3">
        <label for="watermark-size" class="form-label">Text Size</label>
        <input type="range" class="form-range" id="watermark-size" min="12" max="72" value="24" step="1">
        <div class="d-flex justify-content-between">
            <small>Small</small>
            <small id="watermark-size-value">24px</small>
            <small>Large</small>
        </div>
    </div>

    <div class="mb-3">
        <label for="watermark-opacity" class="form-label">Opacity</label>
        <input type="range" class="form-range" id="watermark-opacity" min="0.1" max="1" value="0.5" step="0.1">
        <div class="d-flex justify-content-between">
            <small>Transparent</small>
            <small id="watermark-opacity-value">50%</small>
            <small>Opaque</small>
        </div>
    </div>

    <div class="mb-3">
        <label for="watermark-position" class="form-label">Position</label>
        <select class="form-select" id="watermark-position">
            <option value="bottom-right">Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
            <option value="top-right">Top Right</option>
            <option value="top-left">Top Left</option>
            <option value="center">Center</option>
        </select>
    </div>

    <div class="mb-3">
        <label for="watermark-color" class="form-label">Text Color</label>
        <input type="color" class="form-control form-control-color" id="watermark-color" value="#ffffff">
    </div>

    <div class="d-grid">
        <button class="btn btn-primary" id="apply-watermark-btn">
            <i class="fas fa-copyright me-2"></i>
            Apply Watermark
        </button>
    </div>
</div>

        <!-- Result view -->
        <div class="image-result" id="image-result">
            <h3 class="h5 mb-3">Result</h3>

            <div class="image-preview-container">
                <img id="result-preview" class="image-preview" alt="Edited image">
            </div>

            <div class="result-actions">
                <button class="btn btn-secondary" id="edit-again-btn">
                    <i class="fas fa-undo me-2"></i>
                    Edit Again
                </button>
                <button class="btn btn-success" id="apply-more-btn">
                    <i class="fas fa-plus-circle me-2"></i>
                    Apply More Edits
                </button>
                <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-download me-2"></i>
                            Export
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="exportDropdown">
                            <li><a class="dropdown-item" id="export-png" href="#">PNG Format</a></li>
                            <li><a class="dropdown-item" id="export-jpg" href="#">JPG Format</a></li>
                            <li><a class="dropdown-item" id="export-webp" href="#">WebP Format</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" id="export-original" href="#">Original Format</a></li>
                        </ul>
                    </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Utility scripts -->
<script src="{{ url_for('static', filename='js/photo_editing/utils.js') }}"></script>

<!-- Tool scripts -->
<script src="{{ url_for('static', filename='js/photo_editing/scale.js') }}"></script>
<script src="{{ url_for('static', filename='js/photo_editing/rotate.js') }}"></script>
<script src="{{ url_for('static', filename='js/photo_editing/crop.js') }}"></script>
<script src="{{ url_for('static', filename='js/photo_editing/filter.js') }}"></script>
<script src="{{ url_for('static', filename='js/photo_editing/adjust.js') }}"></script>
<script src="{{ url_for('static', filename='js/photo_editing/grid.js') }}"></script>
<script src="{{ url_for('static', filename='js/photo_editing/watermark.js') }}"></script>


<!-- Main photo editing script -->
<script src="{{ url_for('static', filename='js/photo_editing/main.js') }}"></script>
{% endblock %}