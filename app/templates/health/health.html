{% extends "base.html" %}

{% block head %}
<!-- Include health-specific CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/health.css') }}">
<!-- Chart.js for analytics -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h1>
                <i class="fas fa-heartbeat me-2"></i>
                Health Tracking
            </h1>
            <p class="lead">Monitor your workouts, nutrition, and body metrics to achieve your health goals</p>
        </div>
    </div>

    <!-- Health overview cards -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="health-card">
                <div class="card-header">
                    <i class="fas fa-running me-2"></i>
                    Workout Overview
                </div>
                <div class="card-body">
                    <div class="health-stat">
                        <div class="stat-value">{{ workout_stats.total_workouts }}</div>
                        <div class="stat-label">Total Workouts (Last 30 Days)</div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <div class="health-stat">
                                <div class="stat-value">{{ workout_stats.total_duration }}</div>
                                <div class="stat-label">Total Minutes</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="health-stat">
                                <div class="stat-value">{{ workout_stats.total_calories|default(0, true)|int }}</div>
                                <div class="stat-label">Calories Burned</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Water Intake Tracker -->
        <div class="col-md-4 mb-3">
            <div class="health-card">
                <div class="card-header">
                    <i class="fas fa-tint me-2"></i>
                    Hydration Tracker
                </div>
                <div class="card-body">
                    <div class="water-tracker">
                        <div class="water-tracker-content">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h5 class="mb-0">Today's Intake</h5>
                                <span class="fw-bold">{{ total_water_today|round|int }} ml</span>
                            </div>

                            <div class="water-progress">
                                <div class="water-progress-bar" style="width: {{ water_percentage }}%"></div>
                            </div>

                            <div class="d-flex justify-content-between small text-muted mb-3">
                                <span>0 ml</span>
                                <span>Target: 2500 ml</span>
                            </div>

                            <button class="btn btn-primary btn-sm w-100 mb-3" data-bs-toggle="modal" data-bs-target="#addWaterModal">
                                <i class="fas fa-plus me-1"></i> Add Water
                            </button>

                            <h6>Recent Entries:</h6>
                            <div class="water-entries">
                                {% for intake in water_intakes %}
                                    <div class="water-intake-entry">
                                        <span>
                                            <i class="fas fa-tint me-1"></i>
                                            {{ intake.amount|round|int }} ml
                                        </span>
                                        <small class="text-muted">{{ intake.date.strftime('%H:%M') }}</small>
                                        <form method="POST" action="{{ url_for('health.delete_water', water_id=intake.id) }}" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-link text-danger p-0">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </form>
                                    </div>
                                {% else %}
                                    <div class="text-center text-muted">
                                        <small>No entries yet today</small>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workout Streak and Body Metrics -->
        <div class="col-md-4 mb-3">
            <div class="streak-counter">
                <i class="fas fa-fire mb-2" style="font-size: 1.5rem;"></i>
                <div class="streak-value">{{ workout_stats.streak }}</div>
                <div class="streak-label">Day Workout Streak</div>
                <small class="text-white-50">Keep it going!</small>
            </div>

            <div class="health-card">
                <div class="card-header">
                    <i class="fas fa-weight me-2"></i>
                    Body Metrics
                </div>
                <div class="card-body">
                    {% if latest_metrics %}
                        <div class="text-center mb-3">
                            <span class="d-block text-muted small">Last updated: {{ latest_metrics.date.strftime('%Y-%m-%d') }}</span>
                        </div>
                        <div class="row">
                            <div class="col-6 mb-3">
                                <div class="health-stat">
                                    <div class="stat-value">{{ latest_metrics.weight|round(1) if latest_metrics.weight else '--' }}</div>
                                    <div class="stat-label">Weight (kg)</div>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="health-stat">
                                    <div class="stat-value">{{ latest_metrics.bmi|round(1) if latest_metrics.bmi else '--' }}</div>
                                    <div class="stat-label">BMI</div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center py-3">
                            <p class="mb-3">No body metrics recorded yet</p>
                        </div>
                    {% endif %}
                    <button class="btn btn-primary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#addMetricsModal">
                        <i class="fas fa-plus me-1"></i> Update Measurements
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main health tracking tabs -->
    <div class="row">
        <div class="col-12">
            <div class="card health-card">
                <div class="card-header bg-primary text-white">
                    <ul class="nav nav-tabs card-header-tabs" id="healthTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active text-dark" id="workouts-tab" data-bs-toggle="tab" data-bs-target="#workouts-tab-pane" type="button" role="tab" aria-controls="workouts-tab-pane" aria-selected="true">
                                <i class="fas fa-dumbbell me-1"></i> Workouts
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-dark" id="nutrition-tab" data-bs-toggle="tab" data-bs-target="#nutrition-tab-pane" type="button" role="tab" aria-controls="nutrition-tab-pane" aria-selected="false">
                                <i class="fas fa-apple-alt me-1"></i> Nutrition
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-dark" id="metrics-tab" data-bs-toggle="tab" data-bs-target="#metrics-tab-pane" type="button" role="tab" aria-controls="metrics-tab-pane" aria-selected="false">
                                <i class="fas fa-weight me-1"></i> Body Metrics
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-dark" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics-tab-pane" type="button" role="tab" aria-controls="analytics-tab-pane" aria-selected="false">
                                <i class="fas fa-chart-pie me-1"></i> Analytics
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="healthTabsContent">
                       <!-- Workouts Tab -->
<div class="tab-pane fade show active" id="workouts-tab-pane" role="tabpanel" aria-labelledby="workouts-tab" tabindex="0">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">
            <i class="fas fa-dumbbell me-2"></i>
            Your Workouts
        </h4>
        <div>
            <a href="{{ url_for('health.favorite_workouts') }}" class="btn btn-warning me-2">
                <i class="fas fa-star me-1"></i> Favorites
            </a>
            <a href="{{ url_for('health.weekly_report') }}" class="btn btn-success me-2">
                <i class="fas fa-chart-line me-1"></i> Weekly Report
            </a>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addWorkoutModal">
                <i class="fas fa-plus me-1"></i> Add Workout
            </button>
        </div>
    </div>

    <!-- Workout filter/search -->
<div class="row mb-3">
    <div class="col-md-6">
        <input type="text" id="workoutSearch" class="form-control" placeholder="Search workouts...">
    </div>
    <div class="col-md-6">
        <div class="btn-group w-100">
            <button type="button" class="btn btn-outline-primary active workout-filter" data-filter="all">All</button>
            <button type="button" class="btn btn-outline-primary workout-filter" data-filter="cardio">Cardio</button>
            <button type="button" class="btn btn-outline-primary workout-filter" data-filter="strength">Strength</button>
            <button type="button" class="btn btn-outline-primary workout-filter" data-filter="other">Other</button>
        </div>
    </div>
</div>

    {% if workouts %}
        <div class="workout-list">
            {% for workout in workouts %}
                <div class="workout-item position-relative {% if workout.favorite %}workout-favorite{% endif %}"
                     data-workout-id="{{ workout.id }}"
                     data-workout-type="{{ workout.workout_type }}"
                     data-completed="{{ workout.completed|lower }}">

                    {% if workout.favorite %}
                        <div class="favorite-badge">
                            <i class="fas fa-star"></i>
                        </div>
                    {% endif %}

                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h5 class="workout-title mb-1">
                                {{ workout.title }}
                                <span class="badge badge-workout-type badge-{{ workout.workout_type }}">
                                    {{ workout.workout_type.capitalize() }}
                                </span>

                                {% if not workout.completed %}
                                    <span class="badge bg-warning">In Progress</span>
                                {% endif %}
                            </h5>
                            <div class="workout-meta">
                                <span class="me-3">
                                    <i class="fas fa-calendar-alt me-1"></i>
                                    {{ workout.date.strftime('%Y-%m-%d %H:%M') }}
                                </span>
                                <span class="me-3">
                                    <i class="fas fa-clock me-1"></i>
                                    {{ workout.duration }} minutes
                                </span>
                                {% if workout.intensity %}
                                    <span class="me-3">
                                        <i class="fas fa-tachometer-alt me-1"></i>
                                        Intensity: {{ workout.intensity.capitalize() }}
                                    </span>
                                {% endif %}
                                {% if workout.calories_burned %}
                                    <span>
                                        <i class="fas fa-fire me-1"></i>
                                        {{ workout.calories_burned }} calories
                                    </span>
                                {% endif %}
                            </div>

                            {% if workout.exercises.count() > 0 %}
                                <div class="mt-2">
                                    <span class="badge bg-secondary">
                                        <i class="fas fa-dumbbell me-1"></i>
                                        {{ workout.exercises.count() }} exercises
                                    </span>
                                </div>
                            {% endif %}

                            {% if workout.notes %}
                                <p class="mt-2 mb-0">{{ workout.notes }}</p>
                            {% endif %}
                        </div>
                    </div>
                    <div class="workout-actions">
                        <button class="btn btn-sm btn-outline-primary me-1 view-workout-btn"
                                data-workout-id="{{ workout.id }}"
                                data-bs-toggle="modal"
                                data-bs-target="#viewWorkoutModal">
                            <i class="fas fa-eye"></i>
                        </button>

                        {% if not workout.completed %}
                            <a href="{{ url_for('health.add_exercises', workout_id=workout.id) }}"
                               class="btn btn-sm btn-outline-info me-1" title="Add exercises">
                                <i class="fas fa-dumbbell"></i>
                            </a>

                            <form method="POST" action="{{ url_for('health.complete_workout', workout_id=workout.id) }}" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-outline-success me-1" title="Mark as completed">
                                    <i class="fas fa-check"></i>
                                </button>
                            </form>
                        {% endif %}

                        <button class="btn btn-sm btn-outline-secondary me-1 edit-workout-btn"
                                data-workout-id="{{ workout.id }}"
                                data-bs-toggle="modal"
                                data-bs-target="#editWorkoutModal">
                            <i class="fas fa-edit"></i>
                        </button>

                        <form method="POST" action="{{ url_for('health.toggle_favorite', workout_id=workout.id) }}" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-warning me-1" title="{% if workout.favorite %}Remove from favorites{% else %}Add to favorites{% endif %}">
                                <i class="fas fa-{% if workout.favorite %}star{% else %}star-half-alt{% endif %}"></i>
                            </button>
                        </form>

                        <form method="POST" action="{{ url_for('health.create_template', workout_id=workout.id) }}" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-primary me-1" title="Save as template">
                                <i class="fas fa-copy"></i>
                            </button>
                        </form>

                        <button class="btn btn-sm btn-outline-danger delete-workout-btn"
                                data-workout-id="{{ workout.id }}"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteWorkoutModal">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-health-state">
            <i class="fas fa-dumbbell text-muted"></i>
            <h4>No workouts recorded</h4>
            <p>Start tracking your workouts by clicking the "Add Workout" button.</p>
        </div>
    {% endif %}
</div>

                        <!-- Nutrition Tab -->
                        <div class="tab-pane fade" id="nutrition-tab-pane" role="tabpanel" aria-labelledby="nutrition-tab" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4 class="mb-0">
                                    <i class="fas fa-utensils me-2"></i>
                                    Your Meals
                                </h4>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMealModal">
                                    <i class="fas fa-plus me-1"></i> Add Meal
                                </button>
                            </div>

                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <div class="health-card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Daily Nutrition Summary</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="nutrition-info">
                                                <span class="nutrition-info-label">Daily Target:</span>
                                                <span class="nutrition-info-value">2000 kcal</span>
                                            </div>
                                            <div class="nutrition-info">
                                                <span class="nutrition-info-label">Today's Intake:</span>
                                                <span class="nutrition-info-value">
                                                    {{ nutrition_stats.total_calories|default(0, true)|int }} kcal
                                                </span>
                                            </div>
                                            <div class="nutrition-info">
                                                <span class="nutrition-info-label">Protein:</span>
                                                <span class="nutrition-info-value">
                                                    {{ nutrition_stats.total_protein|default(0, true)|round(1) }} g
                                                </span>
                                            </div>
                                            <div class="nutrition-info">
                                                <span class="nutrition-info-label">Carbs:</span>
                                                <span class="nutrition-info-value">
                                                    {{ nutrition_stats.total_carbs|default(0, true)|round(1) }} g
                                                </span>
                                            </div>
                                            <div class="nutrition-info">
                                                <span class="nutrition-info-label">Fat:</span>
                                                <span class="nutrition-info-value">
                                                    {{ nutrition_stats.total_fat|default(0, true)|round(1) }} g
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <div class="health-card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Macronutrient Distribution</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container">
                                                <canvas id="macrosChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {% if meals %}
                                <div class="meal-list">
                                    {% for meal in meals %}
                                        <div class="meal-item" data-meal-id="{{ meal.id }}">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-grow-1">
                                                    <h5 class="meal-title">
                                                        {{ meal.name.capitalize() }}
                                                        <span class="badge badge-meal-type badge-{{ meal.name }}">
                                                            {{ meal.name.capitalize() }}
                                                        </span>
                                                    </h5>
                                                    <div class="meal-meta">
                                                        <span class="me-3">
                                                            <i class="fas fa-calendar-alt me-1"></i>
                                                            {{ meal.meal_time.strftime('%Y-%m-%d %H:%M') }}
                                                        </span>
                                                        {% if meal.calories %}
                                                            <span class="nutrition-tag tag-calories">
                                                                <i class="fas fa-fire me-1"></i>
                                                                {{ meal.calories }} kcal
                                                            </span>
                                                        {% endif %}
                                                        {% if meal.protein %}
                                                            <span class="nutrition-tag tag-protein">
                                                                <i class="fas fa-drumstick-bite me-1"></i>
                                                                {{ meal.protein }}g protein
                                                            </span>
                                                        {% endif %}
                                                        {% if meal.carbs %}
                                                            <span class="nutrition-tag tag-carbs">
                                                                <i class="fas fa-bread-slice me-1"></i>
                                                                {{ meal.carbs }}g carbs
                                                            </span>
                                                        {% endif %}
                                                        {% if meal.fat %}
                                                            <span class="nutrition-tag tag-fat">
                                                                <i class="fas fa-cheese me-1"></i>
                                                                {{ meal.fat }}g fat
                                                            </span>
                                                        {% endif %}
                                                    </div>
                                                    <p class="mt-2 mb-0">{{ meal.food_items }}</p>
                                                </div>
                                            </div>
                                            <div class="meal-actions">
                                                <button class="btn btn-sm btn-outline-primary me-1 view-meal-btn"
                                                        data-meal-id="{{ meal.id }}"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#viewMealModal">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-secondary me-1 edit-meal-btn"
                                                        data-meal-id="{{ meal.id }}"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editMealModal">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger delete-meal-btn"
                                                        data-meal-id="{{ meal.id }}"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#deleteMealModal">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="empty-health-state">
                                    <i class="fas fa-utensils text-muted"></i>
                                    <h4>No meals recorded</h4>
                                    <p>Start tracking your nutrition by clicking the "Add Meal" button.</p>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Body Metrics Tab -->
                        <div class="tab-pane fade" id="metrics-tab-pane" role="tabpanel" aria-labelledby="metrics-tab" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4 class="mb-0">
                                    <i class="fas fa-weight me-2"></i>
                                    Body Measurements
                                </h4>
                                <div>
                                    <a href="{{ url_for('health.weekly_report') }}" class="btn btn-success me-2">
                                        <i class="fas fa-chart-line me-1"></i> Weekly Report
                                    </a>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMetricsModal">
                                        <i class="fas fa-plus me-1"></i> Add Measurements
                                    </button>
                                </div>
                            </div>

                            <!-- Weight Chart -->
                            <div class="health-card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Weight Trend</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="weightChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="health-card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Measurement History</h5>
                                        </div>
                                        <div class="card-body">
                                            {% if metrics %}
                                                <div class="metrics-tracker">
                                                    {% for metric in metrics %}
                                                        <div class="metrics-entry">
                                                            <div class="metrics-date">
                                                                {{ metric.date.strftime('%b %d, %Y') }}
                                                            </div>
                                                            <div class="metrics-value">
                                                                {{ metric.weight|round(1) if metric.weight else '--' }} <span>kg</span>
                                                            </div>
                                                            <div class="btn-group">
                                                                <button class="btn btn-sm btn-outline-primary me-1 view-metrics-btn"
                                                                        data-metrics-id="{{ metric.id }}"
                                                                        data-bs-toggle="modal"
                                                                        data-bs-target="#viewMetricsModal">
                                                                    <i class="fas fa-eye"></i>
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-secondary me-1 edit-metrics-btn"
                                                                        data-metrics-id="{{ metric.id }}"
                                                                        data-bs-toggle="modal"
                                                                        data-bs-target="#editMetricsModal">
                                                                    <i class="fas fa-edit"></i>
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-danger delete-metrics-btn"
                                                                        data-metrics-id="{{ metric.id }}"
                                                                        data-bs-toggle="modal"
                                                                        data-bs-target="#deleteMetricsModal">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <div class="empty-health-state">
                                                    <i class="fas fa-weight text-muted"></i>
                                                    <h4>No measurements recorded</h4>
                                                    <p>Start tracking your body measurements.</p>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-4">
                                    <div class="health-card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Health Tips</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="health-tip">
                                                <div class="health-tip-title">
                                                    <i class="fas fa-lightbulb me-1"></i>
                                                    Weigh Yourself Consistently
                                                </div>
                                                <p class="mb-0">For the most accurate tracking, weigh yourself at the same time of day (preferably in the morning) wearing similar clothing.</p>
                                            </div>

                                            <div class="health-tip">
                                                <div class="health-tip-title">
                                                    <i class="fas fa-lightbulb me-1"></i>
                                                    Focus on Trends, Not Daily Fluctuations
                                                </div>
                                                <p class="mb-0">Weight can fluctuate up to 5 pounds day-to-day due to water retention, food, and other factors. Focus on the overall trend over weeks.</p>
                                            </div>

                                            <div class="health-tip">
                                                <div class="health-tip-title">
                                                    <i class="fas fa-lightbulb me-1"></i>
                                                    Track More Than Just Weight
                                                </div>
                                                <p class="mb-0">Body measurements like waist, chest, and thighs can often show progress even when the scale doesn't.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Analytics Tab -->
                        <div class="tab-pane fade" id="analytics-tab-pane" role="tabpanel" aria-labelledby="analytics-tab" tabindex="0">
                            <h4 class="mb-3">
                                <i class="fas fa-chart-line me-2"></i>
                                Health Analytics
                            </h4>

                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Workout Types</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container">
                                                <canvas id="workoutTypeChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Nutrition Breakdown</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container">
                                                <canvas id="nutritionChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Weekly Workout Activity</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container">
                                                <canvas id="weeklyWorkoutChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Daily Calorie Intake</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container">
                                                <canvas id="calorieChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Health trends analysis -->
                            <div class="health-card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Your Health Insights</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="health-tip">
                                                <div class="health-tip-title">
                                                    <i class="fas fa-medal me-1"></i>
                                                    Workout Consistency
                                                </div>
                                                <p>
                                                    {% if workout_stats.total_workouts > 8 %}
                                                        Great job! You've been very consistent with your workouts this month.
                                                    {% elif workout_stats.total_workouts > 4 %}
                                                        You're doing well with workout consistency. Try to maintain this rhythm.
                                                    {% else %}
                                                        Try to increase your workout frequency for better results.
                                                    {% endif %}
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="health-tip">
                                                <div class="health-tip-title">
                                                    <i class="fas fa-utensils me-1"></i>
                                                    Nutrition Balance
                                                </div>
                                                <p>
                                                    {% if nutrition_stats.total_meals > 0 %}
                                                        {% if nutrition_stats.total_protein > 0 %}
                                                            Your protein intake is {{ nutrition_stats.total_protein|round(1) }}g for the past 30 days.
                                                            {% if nutrition_stats.total_protein / 30 < 50 %}
                                                                Consider increasing your daily protein intake.
                                                            {% endif %}
                                                        {% else %}
                                                            Try to track your protein intake for better nutritional insights.
                                                        {% endif %}
                                                    {% else %}
                                                        Start tracking your meals to get nutrition insights.
                                                    {% endif %}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Workout Modal -->
<div class="modal fade" id="addWorkoutModal" tabindex="-1" aria-labelledby="addWorkoutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addWorkoutModalLabel">
                    <i class="fas fa-dumbbell me-2"></i>
                    Add New Workout
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newWorkoutForm" method="POST" action="{{ url_for('health.create_workout') }}">
                    {{ workout_form.hidden_tag() }}

                    <div class="row">
                        <div class="col-md-8 mb-3">
                            {{ workout_form.title.label(class="form-label") }}
                            {{ workout_form.title(class="form-control", placeholder="e.g. Morning Run, Weight Training") }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ workout_form.workout_type.label(class="form-label") }}
                            {{ workout_form.workout_type(class="form-select") }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            {{ workout_form.duration.label(class="form-label") }}
                            {{ workout_form.duration(class="form-control", placeholder="Duration in minutes") }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ workout_form.intensity.label(class="form-label") }}
                            {{ workout_form.intensity(class="form-select") }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ workout_form.calories_burned.label(class="form-label") }}
                            {{ workout_form.calories_burned(class="form-control", placeholder="Optional") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ workout_form.date.label(class="form-label") }}
                        {{ workout_form.date(class="form-control", type="datetime-local") }}
                    </div>

                    <div class="mb-3">
                        {{ workout_form.notes.label(class="form-label") }}
                        {{ workout_form.notes(class="form-control", rows="3", placeholder="Optional notes about your workout") }}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                {{ workout_form.completed(class="form-check-input") }}
                                {{ workout_form.completed.label(class="form-check-label") }}
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                {{ workout_form.favorite(class="form-check-input") }}
                                {{ workout_form.favorite.label(class="form-check-label") }}
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="newWorkoutForm" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Save Workout
                </button>
            </div>
        </div>
    </div>
</div>

<!-- View Workout Modal -->
<div class="modal fade" id="viewWorkoutModal" tabindex="-1" aria-labelledby="viewWorkoutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewWorkoutModalLabel">
                    <i class="fas fa-dumbbell me-2"></i>
                    <span id="viewWorkoutTitle">Workout Details</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-8">
                        <div id="viewWorkoutNotes" class="mb-3">
                            <h5>Notes</h5>
                            <p class="border p-3 rounded bg-light">No notes provided.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="mb-0">Workout Details</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Type:</strong> <span id="viewWorkoutType"></span></p>
                                <p><strong>Duration:</strong> <span id="viewWorkoutDuration"></span> minutes</p>
                                <p><strong>Intensity:</strong> <span id="viewWorkoutIntensity"></span></p>
                                <p><strong>Calories:</strong> <span id="viewWorkoutCalories"></span></p>
                                <p><strong>Date:</strong> <span id="viewWorkoutDate"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="editFromViewWorkoutBtn">
                    <i class="fas fa-edit me-1"></i> Edit
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Workout Modal -->
<div class="modal fade" id="editWorkoutModal" tabindex="-1" aria-labelledby="editWorkoutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editWorkoutModalLabel">
                    <i class="fas fa-edit me-2"></i>
                    Edit Workout
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editWorkoutForm" method="POST">
                    {{ workout_form.hidden_tag() }}

                    <div class="row">
                        <div class="col-md-8 mb-3">
                            {{ workout_form.title.label(class="form-label") }}
                            {{ workout_form.title(class="form-control", id="editWorkoutTitle") }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ workout_form.workout_type.label(class="form-label") }}
                            {{ workout_form.workout_type(class="form-select", id="editWorkoutType") }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            {{ workout_form.duration.label(class="form-label") }}
                            {{ workout_form.duration(class="form-control", id="editWorkoutDuration") }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ workout_form.intensity.label(class="form-label") }}
                            {{ workout_form.intensity(class="form-select", id="editWorkoutIntensity") }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ workout_form.calories_burned.label(class="form-label") }}
                            {{ workout_form.calories_burned(class="form-control", id="editWorkoutCalories") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ workout_form.date.label(class="form-label") }}
                        {{ workout_form.date(class="form-control", type="datetime-local", id="editWorkoutDate") }}
                    </div>

                    <div class="mb-3">
                        {{ workout_form.notes.label(class="form-label") }}
                        {{ workout_form.notes(class="form-control", rows="3", id="editWorkoutNotes") }}
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="updateWorkoutBtn">
                    <i class="fas fa-save me-1"></i> Save Changes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Workout Modal -->
<div class="modal fade" id="deleteWorkoutModal" tabindex="-1" aria-labelledby="deleteWorkoutModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteWorkoutModalLabel">
                    <i class="fas fa-trash-alt me-2"></i>
                    Delete Workout
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this workout?</p>
                <p><strong>Title:</strong> <span id="deleteWorkoutTitle"></span></p>
                <p class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i> This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteWorkoutForm" method="POST">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash-alt me-1"></i> Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Meal Modal -->
<div class="modal fade" id="addMealModal" tabindex="-1" aria-labelledby="addMealModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addMealModalLabel">
                    <i class="fas fa-utensils me-2"></i>
                    Add New Meal
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newMealForm" method="POST" action="{{ url_for('health.create_meal') }}">
                    {{ meal_form.hidden_tag() }}

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ meal_form.name.label(class="form-label") }}
                            {{ meal_form.name(class="form-select") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ meal_form.meal_time.label(class="form-label") }}
                            {{ meal_form.meal_time(class="form-control", type="datetime-local") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ meal_form.food_items.label(class="form-label") }}
                        {{ meal_form.food_items(class="form-control", rows="3", placeholder="List the foods you ate") }}
                    </div>

                    <div class="row">
                        <div class="col-md-3 mb-3">
                            {{ meal_form.calories.label(class="form-label") }}
                            {{ meal_form.calories(class="form-control", placeholder="kcal") }}
                        </div>
                        <div class="col-md-3 mb-3">
                            {{ meal_form.protein.label(class="form-label") }}
                            {{ meal_form.protein(class="form-control", placeholder="g") }}
                        </div>
                        <div class="col-md-3 mb-3">
                            {{ meal_form.carbs.label(class="form-label") }}
                            {{ meal_form.carbs(class="form-control", placeholder="g") }}
                        </div>
                        <div class="col-md-3 mb-3">
                            {{ meal_form.fat.label(class="form-label") }}
                            {{ meal_form.fat(class="form-control", placeholder="g") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ meal_form.notes.label(class="form-label") }}
                        {{ meal_form.notes(class="form-control", rows="2", placeholder="Optional notes about your meal") }}
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="newMealForm" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Save Meal
                </button>
            </div>
        </div>
    </div>
</div>

<!-- View Meal Modal -->
<div class="modal fade" id="viewMealModal" tabindex="-1" aria-labelledby="viewMealModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewMealModalLabel">
                    <i class="fas fa-utensils me-2"></i>
                    <span id="viewMealTitle">Meal Details</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-8">
                        <div class="mb-3">
                            <h5>Food Items</h5>
                            <p id="viewMealItems" class="border p-3 rounded bg-light"></p>
                        </div>
                        <div id="viewMealNotesSection" class="mb-3">
                            <h5>Notes</h5>
                            <p id="viewMealNotes" class="border p-3 rounded bg-light">No notes provided.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="mb-0">Nutrition Facts</h5>
                            </div>
                            <div class="card-body">
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Calories:</span>
                                    <span id="viewMealCalories" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Protein:</span>
                                    <span id="viewMealProtein" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Carbs:</span>
                                    <span id="viewMealCarbs" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Fat:</span>
                                    <span id="viewMealFat" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Date:</span>
                                    <span id="viewMealTime" class="nutrition-info-value"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="editFromViewMealBtn">
                    <i class="fas fa-edit me-1"></i> Edit
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Meal Modal -->
<div class="modal fade" id="editMealModal" tabindex="-1" aria-labelledby="editMealModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMealModalLabel">
                    <i class="fas fa-edit me-2"></i>
                    Edit Meal
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editMealForm" method="POST">
                    {{ meal_form.hidden_tag() }}

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ meal_form.name.label(class="form-label") }}
                            {{ meal_form.name(class="form-select", id="editMealName") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ meal_form.meal_time.label(class="form-label") }}
                            {{ meal_form.meal_time(class="form-control", type="datetime-local", id="editMealTime") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ meal_form.food_items.label(class="form-label") }}
                        {{ meal_form.food_items(class="form-control", rows="3", id="editMealItems") }}
                    </div>

                    <div class="row">
                        <div class="col-md-3 mb-3">
                            {{ meal_form.calories.label(class="form-label") }}
                            {{ meal_form.calories(class="form-control", id="editMealCalories") }}
                        </div>
                        <div class="col-md-3 mb-3">
                            {{ meal_form.protein.label(class="form-label") }}
                            {{ meal_form.protein(class="form-control", id="editMealProtein") }}
                        </div>
                        <div class="col-md-3 mb-3">
                            {{ meal_form.carbs.label(class="form-label") }}
                            {{ meal_form.carbs(class="form-control", id="editMealCarbs") }}
                        </div>
                        <div class="col-md-3 mb-3">
                            {{ meal_form.fat.label(class="form-label") }}
                            {{ meal_form.fat(class="form-control", id="editMealFat") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ meal_form.notes.label(class="form-label") }}
                        {{ meal_form.notes(class="form-control", rows="2", id="editMealNotes") }}
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="updateMealBtn">
                    <i class="fas fa-save me-1"></i> Save Changes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Meal Modal -->
<div class="modal fade" id="deleteMealModal" tabindex="-1" aria-labelledby="deleteMealModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteMealModalLabel">
                    <i class="fas fa-trash-alt me-2"></i>
                    Delete Meal
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this meal?</p>
                <p><strong>Meal:</strong> <span id="deleteMealTitle"></span></p>
                <p class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i> This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteMealForm" method="POST">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash-alt me-1"></i> Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Body Metrics Modal -->
<div class="modal fade" id="addMetricsModal" tabindex="-1" aria-labelledby="addMetricsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addMetricsModalLabel">
                    <i class="fas fa-weight me-2"></i>
                    Add Body Measurements
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newMetricsForm" method="POST" action="{{ url_for('health.create_metrics') }}">
                    {{ metrics_form.hidden_tag() }}

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.weight.label(class="form-label") }}
                            {{ metrics_form.weight(class="form-control", placeholder="Weight in kg") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.height.label(class="form-label") }}
                            {{ metrics_form.height(class="form-control", placeholder="Height in cm") }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.body_fat.label(class="form-label") }}
                            {{ metrics_form.body_fat(class="form-control", placeholder="Body fat percentage") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.date.label(class="form-label") }}
                            {{ metrics_form.date(class="form-control", type="datetime-local") }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.waist.label(class="form-label") }}
                            {{ metrics_form.waist(class="form-control", placeholder="Waist in cm") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.chest.label(class="form-label") }}
                            {{ metrics_form.chest(class="form-control", placeholder="Chest in cm") }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.arms.label(class="form-label") }}
                            {{ metrics_form.arms(class="form-control", placeholder="Arms in cm") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.thighs.label(class="form-label") }}
                            {{ metrics_form.thighs(class="form-control", placeholder="Thighs in cm") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ metrics_form.notes.label(class="form-label") }}
                        {{ metrics_form.notes(class="form-control", rows="2", placeholder="Optional notes about your measurements") }}
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="newMetricsForm" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Save Measurements
                </button>
            </div>
        </div>
    </div>
</div>

<!-- View Metrics Modal -->
<div class="modal fade" id="viewMetricsModal" tabindex="-1" aria-labelledby="viewMetricsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewMetricsModalLabel">
                    <i class="fas fa-weight me-2"></i>
                    Body Measurements
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <h5 class="mb-3">Measurements for <span id="viewMetricsDate"></span></h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="mb-0">Body Composition</h5>
                            </div>
                            <div class="card-body">
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Weight:</span>
                                    <span id="viewMetricsWeight" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Height:</span>
                                    <span id="viewMetricsHeight" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">BMI:</span>
                                    <span id="viewMetricsBMI" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Body Fat:</span>
                                    <span id="viewMetricsBodyFat" class="nutrition-info-value"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="mb-0">Body Measurements</h5>
                            </div>
                            <div class="card-body">
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Waist:</span>
                                    <span id="viewMetricsWaist" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Chest:</span>
                                    <span id="viewMetricsChest" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Arms:</span>
                                    <span id="viewMetricsArms" class="nutrition-info-value"></span>
                                </div>
                                <div class="nutrition-info">
                                    <span class="nutrition-info-label">Thighs:</span>
                                    <span id="viewMetricsThighs" class="nutrition-info-value"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <h5>Notes</h5>
                    <p id="viewMetricsNotes" class="border p-3 rounded bg-light">No notes provided.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="editFromViewMetricsBtn">
                    <i class="fas fa-edit me-1"></i> Edit
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Metrics Modal -->
<div class="modal fade" id="editMetricsModal" tabindex="-1" aria-labelledby="editMetricsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMetricsModalLabel">
                    <i class="fas fa-edit me-2"></i>
                    Edit Body Measurements
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editMetricsForm" method="POST">
                    {{ metrics_form.hidden_tag() }}

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.weight.label(class="form-label") }}
                            {{ metrics_form.weight(class="form-control", id="editMetricsWeight") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.height.label(class="form-label") }}
                            {{ metrics_form.height(class="form-control", id="editMetricsHeight") }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.body_fat.label(class="form-label") }}
                            {{ metrics_form.body_fat(class="form-control", id="editMetricsBodyFat") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.date.label(class="form-label") }}
                            {{ metrics_form.date(class="form-control", type="datetime-local", id="editMetricsDate") }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.waist.label(class="form-label") }}
                            {{ metrics_form.waist(class="form-control", id="editMetricsWaist") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.chest.label(class="form-label") }}
                            {{ metrics_form.chest(class="form-control", id="editMetricsChest") }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.arms.label(class="form-label") }}
                            {{ metrics_form.arms(class="form-control", id="editMetricsArms") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ metrics_form.thighs.label(class="form-label") }}
                            {{ metrics_form.thighs(class="form-control", id="editMetricsThighs") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ metrics_form.notes.label(class="form-label") }}
                        {{ metrics_form.notes(class="form-control", rows="2", id="editMetricsNotes") }}
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="updateMetricsBtn">
                    <i class="fas fa-save me-1"></i> Save Changes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Metrics Modal -->
<div class="modal fade" id="deleteMetricsModal" tabindex="-1" aria-labelledby="deleteMetricsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteMetricsModalLabel">
                    <i class="fas fa-trash-alt me-2"></i>
                    Delete Measurements
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete these body measurements?</p>
                <p><strong>Date:</strong> <span id="deleteMetricsDate"></span></p>
                <p class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i> This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteMetricsForm" method="POST">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash-alt me-1"></i> Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Water Intake Modal -->
<div class="modal fade" id="addWaterModal" tabindex="-1" aria-labelledby="addWaterModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addWaterModalLabel">
                    <i class="fas fa-tint me-2"></i>
                    Add Water Intake
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newWaterForm" method="POST" action="{{ url_for('health.add_water') }}">
                    {{ water_form.hidden_tag() }}

                    <div class="mb-3">
                        {{ water_form.amount.label(class="form-label") }}
                        <div class="input-group">
                            {{ water_form.amount(class="form-control", placeholder="Amount in ml", id="amount") }}
                            <span class="input-group-text">ml</span>
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ water_form.date.label(class="form-label") }}
                        {{ water_form.date(class="form-control", type="datetime-local") }}
                    </div>

                    <div class="mt-3 mb-2">
                        <p class="mb-2">Quick add:</p>
                        <div class="d-flex flex-wrap gap-2">
                            <button type="button" class="btn btn-outline-primary quick-amount" data-amount="250">250ml</button>
                            <button type="button" class="btn btn-outline-primary quick-amount" data-amount="500">500ml</button>
                            <button type="button" class="btn btn-outline-primary quick-amount" data-amount="750">750ml</button>
                            <button type="button" class="btn btn-outline-primary quick-amount" data-amount="1000">1000ml</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="newWaterForm" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Save
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Add Button -->
<div class="quick-add-btn" data-bs-toggle="modal" data-bs-target="#quickAddModal" title="Quick Add">
    <i class="fas fa-plus"></i>
</div>

<!-- Quick Add Modal -->
<div class="modal fade" id="quickAddModal" tabindex="-1" aria-labelledby="quickAddModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quickAddModalLabel">
                    <i class="fas fa-plus me-2"></i>
                    Quick Add
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#addWorkoutModal">
                        <i class="fas fa-dumbbell me-2"></i> Add Workout
                    </button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#addMealModal">
                        <i class="fas fa-utensils me-2"></i> Add Meal
                    </button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#addWaterModal">
                        <i class="fas fa-tint me-2"></i> Add Water
                    </button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#addMetricsModal">
                        <i class="fas fa-weight me-2"></i> Add Measurements
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/workout.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Workout Operations
        setupWorkoutOperations();

        // Meal Operations
        setupMealOperations();

        // Metrics Operations
        setupMetricsOperations();

        // Charts
        setupHealthCharts();

        // Water intake quick add buttons
        setupWaterIntake();

        function setupWorkoutOperations() {
            // View workout
            const viewWorkoutButtons = document.querySelectorAll('.view-workout-btn');
            viewWorkoutButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const workoutId = this.getAttribute('data-workout-id');
                    fetch(`/health/workouts/${workoutId}`)
                        .then(response => response.json())
                        .then(data => {
                            // Fill modal with workout data
                            document.getElementById('viewWorkoutTitle').textContent = data.title;
                            document.getElementById('viewWorkoutType').textContent = data.workout_type.charAt(0).toUpperCase() + data.workout_type.slice(1);
                            document.getElementById('viewWorkoutDuration').textContent = data.duration;
                            document.getElementById('viewWorkoutIntensity').textContent = data.intensity ? data.intensity.charAt(0).toUpperCase() + data.intensity.slice(1) : 'Not specified';
                            document.getElementById('viewWorkoutCalories').textContent = data.calories_burned ? data.calories_burned + ' kcal' : 'Not specified';
                            document.getElementById('viewWorkoutDate').textContent = new Date(data.date).toLocaleString();

                            // Set notes
                            const notesEl = document.getElementById('viewWorkoutNotes').querySelector('p');
                            notesEl.textContent = data.notes || 'No notes provided.';

                            // Set up edit button
                            const editBtn = document.getElementById('editFromViewWorkoutBtn');
                            editBtn.setAttribute('data-workout-id', data.id);
                            editBtn.addEventListener('click', function() {
                                // Close view modal
                                bootstrap.Modal.getInstance(document.getElementById('viewWorkoutModal')).hide();

                                // Open edit modal with this workout's data
                                const editWorkoutBtn = document.querySelector(`.edit-workout-btn[data-workout-id="${data.id}"]`);
                                editWorkoutBtn.click();
                            });
                        })
                        .catch(error => console.error('Error fetching workout:', error));
                });
            });

            // Edit workout
            const editWorkoutButtons = document.querySelectorAll('.edit-workout-btn');
            editWorkoutButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const workoutId = this.getAttribute('data-workout-id');
                    const form = document.getElementById('editWorkoutForm');
                    form.action = `/health/workouts/${workoutId}/update`;

                    fetch(`/health/workouts/${workoutId}`)
                        .then(response => response.json())
                        .then(data => {
                            // Fill form with workout data
                            document.getElementById('editWorkoutTitle').value = data.title;
                            document.getElementById('editWorkoutType').value = data.workout_type;
                            document.getElementById('editWorkoutDuration').value = data.duration;
                            document.getElementById('editWorkoutIntensity').value = data.intensity || '';
                            document.getElementById('editWorkoutCalories').value = data.calories_burned || '';

                            // Format date for datetime-local input
                            if (data.date) {
                                const date = new Date(data.date);
                                const formattedDate = date.toISOString().slice(0, 16);
                                document.getElementById('editWorkoutDate').value = formattedDate;
                            }

                            document.getElementById('editWorkoutNotes').value = data.notes || '';
                        })
                        .catch(error => console.error('Error fetching workout:', error));
                });
            });

            // Update workout
            const updateWorkoutBtn = document.getElementById('updateWorkoutBtn');
            updateWorkoutBtn.addEventListener('click', function() {
                document.getElementById('editWorkoutForm').submit();
            });

            // Delete workout
            const deleteWorkoutButtons = document.querySelectorAll('.delete-workout-btn');
            deleteWorkoutButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const workoutId = this.getAttribute('data-workout-id');
                    const workoutTitle = this.closest('.workout-item').querySelector('.workout-title').textContent.trim();

                    document.getElementById('deleteWorkoutTitle').textContent = workoutTitle;
                    document.getElementById('deleteWorkoutForm').action = `/health/workouts/${workoutId}/delete`;
                });
            });
        }

        function setupMealOperations() {
            // View meal
            const viewMealButtons = document.querySelectorAll('.view-meal-btn');
            viewMealButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const mealId = this.getAttribute('data-meal-id');
                    fetch(`/health/meals/${mealId}`)
                        .then(response => response.json())
                        .then(data => {
                            // Fill modal with meal data
                            document.getElementById('viewMealTitle').textContent = data.name.charAt(0).toUpperCase() + data.name.slice(1);
                            document.getElementById('viewMealItems').textContent = data.food_items;

                            // Set nutrition values
                            document.getElementById('viewMealCalories').textContent = data.calories ? data.calories + ' kcal' : 'Not specified';
                            document.getElementById('viewMealProtein').textContent = data.protein ? data.protein + ' g' : 'Not specified';
                            document.getElementById('viewMealCarbs').textContent = data.carbs ? data.carbs + ' g' : 'Not specified';
                            document.getElementById('viewMealFat').textContent = data.fat ? data.fat + ' g' : 'Not specified';
                            document.getElementById('viewMealTime').textContent = new Date(data.meal_time).toLocaleString();

                            // Set notes
                            const notesEl = document.getElementById('viewMealNotes');
                            notesEl.textContent = data.notes || 'No notes provided.';

                            // Show/hide notes section based on content
                            if (!data.notes) {
                                document.getElementById('viewMealNotesSection').style.display = 'none';
                            } else {
                                document.getElementById('viewMealNotesSection').style.display = 'block';
                            }

                            // Set up edit button
                            const editBtn = document.getElementById('editFromViewMealBtn');
                            editBtn.setAttribute('data-meal-id', data.id);
                            editBtn.addEventListener('click', function() {
                                // Close view modal
                                bootstrap.Modal.getInstance(document.getElementById('viewMealModal')).hide();

                                // Open edit modal with this meal's data
                                const editMealBtn = document.querySelector(`.edit-meal-btn[data-meal-id="${data.id}"]`);
                                editMealBtn.click();
                            });
                        })
                        .catch(error => console.error('Error fetching meal:', error));
                });
            });

            // Edit meal
            const editMealButtons = document.querySelectorAll('.edit-meal-btn');
            editMealButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const mealId = this.getAttribute('data-meal-id');
                    const form = document.getElementById('editMealForm');
                    form.action = `/health/meals/${mealId}/update`;

                    fetch(`/health/meals/${mealId}`)
                        .then(response => response.json())
                        .then(data => {
                            // Fill form with meal data
                            document.getElementById('editMealName').value = data.name;
                            document.getElementById('editMealItems').value = data.food_items;
                            document.getElementById('editMealCalories').value = data.calories || '';
                            document.getElementById('editMealProtein').value = data.protein || '';
                            document.getElementById('editMealCarbs').value = data.carbs || '';
                            document.getElementById('editMealFat').value = data.fat || '';

                            // Format date for datetime-local input
                            if (data.meal_time) {
                                const date = new Date(data.meal_time);
                                const formattedDate = date.toISOString().slice(0, 16);
                                document.getElementById('editMealTime').value = formattedDate;
                            }

                            document.getElementById('editMealNotes').value = data.notes || '';
                        })
                        .catch(error => console.error('Error fetching meal:', error));
                });
            });

            // Update meal
            const updateMealBtn = document.getElementById('updateMealBtn');
            updateMealBtn.addEventListener('click', function() {
                document.getElementById('editMealForm').submit();
            });

            // Delete meal
            const deleteMealButtons = document.querySelectorAll('.delete-meal-btn');
            deleteMealButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const mealId = this.getAttribute('data-meal-id');
                    const mealTitle = this.closest('.meal-item').querySelector('.meal-title').textContent.trim();

                    document.getElementById('deleteMealTitle').textContent = mealTitle;
                    document.getElementById('deleteMealForm').action = `/health/meals/${mealId}/delete`;
                });
            });
        }

        function setupMetricsOperations() {
            // View metrics
            const viewMetricsButtons = document.querySelectorAll('.view-metrics-btn');
            viewMetricsButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const metricsId = this.getAttribute('data-metrics-id');
                    fetch(`/health/body-metrics/${metricsId}`)
                        .then(response => response.json())
                        .then(data => {
                            // Fill modal with metrics data
                            document.getElementById('viewMetricsDate').textContent = new Date(data.date).toLocaleDateString();
                            document.getElementById('viewMetricsWeight').textContent = data.weight ? data.weight + ' kg' : 'Not recorded';
                            document.getElementById('viewMetricsHeight').textContent = data.height ? data.height + ' cm' : 'Not recorded';
                            document.getElementById('viewMetricsBMI').textContent = data.bmi ? data.bmi.toFixed(1) : 'Not calculated';
                            document.getElementById('viewMetricsBodyFat').textContent = data.body_fat ? data.body_fat + '%' : 'Not recorded';
                            document.getElementById('viewMetricsWaist').textContent = data.waist ? data.waist + ' cm' : 'Not recorded';
                            document.getElementById('viewMetricsChest').textContent = data.chest ? data.chest + ' cm' : 'Not recorded';
                            document.getElementById('viewMetricsArms').textContent = data.arms ? data.arms + ' cm' : 'Not recorded';
                            document.getElementById('viewMetricsThighs').textContent = data.thighs ? data.thighs + ' cm' : 'Not recorded';

                            // Set notes
                            const notesEl = document.getElementById('viewMetricsNotes');
                            notesEl.textContent = data.notes || 'No notes provided.';

                            // Set up edit button
                            const editBtn = document.getElementById('editFromViewMetricsBtn');
                            editBtn.setAttribute('data-metrics-id', data.id);
                            editBtn.addEventListener('click', function() {
                                // Close view modal
                                bootstrap.Modal.getInstance(document.getElementById('viewMetricsModal')).hide();

                                // Open edit modal with this metrics's data
                                const editMetricsBtn = document.querySelector(`.edit-metrics-btn[data-metrics-id="${data.id}"]`);
                                editMetricsBtn.click();
                            });
                        })
                        .catch(error => console.error('Error fetching metrics:', error));
                });
            });

            // Edit metrics
            const editMetricsButtons = document.querySelectorAll('.edit-metrics-btn');
            editMetricsButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const metricsId = this.getAttribute('data-metrics-id');
                    document.getElementById('editMetricsForm').action = `/health/body-metrics/${metricsId}/update`;

                    fetch(`/health/body-metrics/${metricsId}`)
                        .then(response => response.json())
                        .then(data => {
                            // Fill form with metrics data
                            document.getElementById('editMetricsWeight').value = data.weight || '';
                            document.getElementById('editMetricsHeight').value = data.height || '';
                            document.getElementById('editMetricsBodyFat').value = data.body_fat || '';
                            document.getElementById('editMetricsWaist').value = data.waist || '';
                            document.getElementById('editMetricsChest').value = data.chest || '';
                            document.getElementById('editMetricsArms').value = data.arms || '';
                            document.getElementById('editMetricsThighs').value = data.thighs || '';

                            // Format date for datetime-local input
                            if (data.date) {
                                const date = new Date(data.date);
                                const formattedDate = date.toISOString().slice(0, 16);
                                document.getElementById('editMetricsDate').value = formattedDate;
                            }

                            document.getElementById('editMetricsNotes').value = data.notes || '';
                        })
                        .catch(error => console.error('Error fetching metrics:', error));
                });
            });

            // Update metrics
            const updateMetricsBtn = document.getElementById('updateMetricsBtn');
            if (updateMetricsBtn) {
                updateMetricsBtn.addEventListener('click', function() {
                    document.getElementById('editMetricsForm').submit();
                });
            }

            // Delete metrics
            const deleteMetricsButtons = document.querySelectorAll('.delete-metrics-btn');
            deleteMetricsButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const metricsId = this.getAttribute('data-metrics-id');
                    const metricsDate = this.closest('.metrics-entry').querySelector('.metrics-date').textContent.trim();

                    document.getElementById('deleteMetricsDate').textContent = metricsDate;
                    document.getElementById('deleteMetricsForm').action = `/health/body-metrics/${metricsId}/delete`;
                });
            });
        }

        function setupWaterIntake() {
            // Set up water intake quick add buttons
            const quickAmountButtons = document.querySelectorAll('.quick-amount');
            const amountInput = document.getElementById('amount');

            if (quickAmountButtons.length && amountInput) {
                quickAmountButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const amount = this.getAttribute('data-amount');
                        amountInput.value = amount;
                    });
                });
            }
        }

        function setupHealthCharts() {
            // Workout Type Chart
            const workoutTypeChart = document.getElementById('workoutTypeChart');
            if (workoutTypeChart) {
                // Extract data from workout_stats
                const workoutTypes = {{ workout_stats.by_type|tojson }};
                const labels = Object.keys(workoutTypes);
                const data = Object.values(workoutTypes);

                // Workout type colors
                const typeColors = {
                    'cardio': 'rgba(87, 167, 115, 0.8)',
                    'strength': 'rgba(128, 144, 178, 0.8)',
                    'flexibility': 'rgba(183, 201, 232, 0.8)',
                    'sports': 'rgba(161, 178, 212, 0.8)',
                    'hiit': 'rgba(215, 100, 100, 0.8)',
                    'crossfit': 'rgba(243, 201, 105, 0.8)',
                    'yoga': 'rgba(196, 214, 232, 0.8)',
                    'other': 'rgba(108, 117, 125, 0.8)'
                };

                // Create colors array
                const colors = labels.map(label => typeColors[label] || 'rgba(108, 117, 125, 0.8)');

                // Create workout types chart
                new Chart(workoutTypeChart, {
                    type: 'doughnut',
                    data: {
                        labels: labels.map(label => label.charAt(0).toUpperCase() + label.slice(1)),
                        datasets: [{
                            data: data,
                            backgroundColor: colors,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Workout Types Distribution'
                            }
                        }
                    }
                });
            }

            // Create nutrition chart
            const nutritionChart = document.getElementById('nutritionChart');
            if (nutritionChart) {
                // Extract nutrition data
                const protein = {{ nutrition_stats.total_protein|default(0, true) }};
                const carbs = {{ nutrition_stats.total_carbs|default(0, true) }};
                const fat = {{ nutrition_stats.total_fat|default(0, true) }};

                // Create pie chart for macronutrients
                new Chart(nutritionChart, {
                    type: 'pie',
                    data: {
                        labels: ['Protein', 'Carbs', 'Fat'],
                        datasets: [{
                            data: [protein, carbs, fat],
                            backgroundColor: [
                                'rgba(87, 167, 115, 0.8)',
                                'rgba(183, 201, 232, 0.8)',
                                'rgba(215, 100, 100, 0.8)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Macronutrient Distribution (g)'
                            }
                        }
                    }
                });
            }

            // Macros chart for nutrition tab
            const macrosChart = document.getElementById('macrosChart');
            if (macrosChart) {
                // Extract nutrition data
                const protein = {{ nutrition_stats.total_protein|default(0, true) }};
                const carbs = {{ nutrition_stats.total_carbs|default(0, true) }};
                const fat = {{ nutrition_stats.total_fat|default(0, true) }};

                // Create pie chart for macronutrients
                new Chart(macrosChart, {
                    type: 'doughnut',
                    data: {
                        labels: ['Protein', 'Carbs', 'Fat'],
                        datasets: [{
                            data: [protein, carbs, fat],
                            backgroundColor: [
                                'rgba(87, 167, 115, 0.8)',
                                'rgba(183, 201, 232, 0.8)',
                                'rgba(215, 100, 100, 0.8)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                position: 'right'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.raw.toFixed(1) + 'g (' + Math.round(context.raw / (protein + carbs + fat) * 100) + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Weekly workout chart
            const weeklyWorkoutChart = document.getElementById('weeklyWorkoutChart');
            if (weeklyWorkoutChart) {
                // Daily workout data for past 14 days
                const dates = {{ workout_dates|tojson }};
                const durations = {{ workout_durations|tojson }};

                new Chart(weeklyWorkoutChart, {
                    type: 'bar',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Workout Minutes',
                            data: durations,
                            backgroundColor: 'rgba(161, 178, 212, 0.8)',
                            borderColor: 'rgba(161, 178, 212, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Minutes'
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Weekly Workout Minutes'
                            }
                        }
                    }
                });
            }

            // Calorie chart
            const calorieChart = document.getElementById('calorieChart');
            if (calorieChart) {
                // Daily calorie data
                const calorieDates = {{ calorie_dates|tojson }};
                const calorieData = {{ calorie_data|tojson }};

                new Chart(calorieChart, {
                    type: 'line',
                    data: {
                        labels: calorieDates,
                        datasets: [{
                            label: 'Calories',
                            data: calorieData,
                            backgroundColor: 'rgba(243, 201, 105, 0.2)',
                            borderColor: 'rgba(243, 201, 105, 1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Calories (kcal)'
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Daily Calorie Intake'
                            }
                        }
                    }
                });
            }

            // Weight Chart
            const weightChartCanvas = document.getElementById('weightChart');
            if (weightChartCanvas) {
                const ctx = weightChartCanvas.getContext('2d');

                const weightData = {
                    labels: {{ metrics_dates|tojson }},
                    datasets: [{
                        label: 'Weight (kg)',
                        data: {{ weights|tojson }},
                        backgroundColor: 'rgba(161, 178, 212, 0.2)',
                        borderColor: 'rgba(161, 178, 212, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                };

                const weightChart = new Chart(ctx, {
                    type: 'line',
                    data: weightData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    precision: 1
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.raw + ' kg';
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: 'Weight Trend'
                            }
                        }
                    }
                });
            }
        }
    });
</script>
{% endblock %}