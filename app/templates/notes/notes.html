{% extends "base.html" %}

{% block head %}
<style>
    /* Notes Board Styles */
    .notes-container {
        position: relative;
        min-height: 600px;
        background-color: rgba(var(--bs-dark-rgb), 0.02);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
    }

    [data-bs-theme="dark"] .notes-container {
        box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.3);
        background-color: rgba(var(--bs-dark-rgb), 0.2);
    }

    .notes-container-guide {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0.15;
        pointer-events: none;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1;
    }

    .notes-container:empty .notes-container-guide,
    .notes-container.filtered-empty .notes-container-guide {
        opacity: 0.7;
    }

    .guide-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--primary);
    }

    .guide-text {
        font-size: 1.2rem;
        color: var(--text-secondary);
    }

    .sticky-note {
        position: absolute;
        width: 220px;
        min-height: 220px;
        padding: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        border-radius: 5px;
        cursor: move;
        transition: box-shadow 0.3s ease, transform 0.3s ease;
        overflow: hidden;
    }

    .sticky-note.is-pinned::after {
        content: '';
        position: absolute;
        top: -6px;
        left: 50%;
        transform: translateX(-50%);
        width: 12px;
        height: 12px;
        background-color: var(--danger);
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .sticky-note::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 28px;
        background: rgba(0, 0, 0, 0.1);
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
    }

    .sticky-note:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        transform: scale(1.02);
    }

    .note-title {
        margin-top: 5px;
        font-weight: 600;
        font-family: 'McLaren', sans-serif;
        font-size: 16px;
        margin-bottom: 10px;
        padding-right: 30px; /* Make room for controls */
        word-break: break-word;
        white-space: normal;
        line-height: 1.4;
    }

    .note-content {
        margin-top: 10px;
        font-family: 'McLaren', sans-serif;
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 14px;
        line-height: 1.5;
    }

    .note-controls {
        position: absolute;
        top: 2px;
        right: 2px;
        padding: 5px;
        opacity: 0.2;
        transition: opacity 0.2s ease;
        display: flex;
        flex-direction: column;
        gap: 3px;
    }

    .sticky-note:hover .note-controls {
        opacity: 1;
    }

    .note-btn {
        border: none;
        background: none;
        font-size: 0.8rem;
        cursor: pointer;
        color: #444;
        transition: transform 0.2s ease;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(255, 255, 255, 0.7);
    }

    .note-btn:hover {
        transform: scale(1.2);
        background-color: white;
    }

    .note-btn.pin-note {
        color: #f39c12;
    }

    .note-btn.edit-note {
        color: #2e86de;
    }

    .note-btn.delete-note {
        color: #e74c3c;
    }

    .note-btn.front-note {
        color: #8e44ad;
    }

    .create-note-container {
        background-color: var(--card-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: var(--card-shadow);
        margin-bottom: 30px;
    }

    .color-picker {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
    }

    .color-option {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        position: relative;
        border: 2px solid transparent;
    }

    .color-option.selected {
        border-color: rgba(0, 0, 0, 0.3);
        box-shadow: 0 0 0 2px white;
        transform: scale(1.1);
    }

    .color-option:hover {
        transform: scale(1.2);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .note-footer {
        font-size: 0.7rem;
        color: rgba(0, 0, 0, 0.5);
        position: absolute;
        bottom: 5px;
        left: 10px;
        right: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .note-tags {
        margin-top: 15px;
        margin-bottom: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }

    .note-tag {
        font-size: 0.7rem;
        background-color: rgba(0, 0, 0, 0.1);
        color: rgba(0, 0, 0, 0.7);
        padding: 2px 8px;
        border-radius: 10px;
        display: inline-block;
        max-width: 100px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .note-timestamp {
        font-size: 0.7rem;
        color: rgba(0, 0, 0, 0.5);
    }

    /* Note Modal */
    .note-modal .modal-content {
        border-radius: 10px;
    }

    .note-modal .modal-header {
        border-bottom: none;
        padding-bottom: 0;
    }

    .note-modal .modal-body {
        padding-top: 0;
    }

    .note-modal textarea {
        border: none;
        width: 100%;
        min-height: 200px;
        padding: 10px;
        font-family: 'McLaren', sans-serif;
        resize: none;
        outline: none !important;
        box-shadow: none !important;
    }

    /* Filter bar */
    .filter-bar {
        background-color: var(--card-bg);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: var(--card-shadow);
    }

    .filter-dropdown {
        min-width: 150px;
    }

    .filter-option {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .filter-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
    }

    /* Instructions */
    .instructions {
        margin-bottom: 20px;
        padding: 15px;
        background-color: rgba(var(--bs-info-rgb), 0.1);
        border-radius: 10px;
    }

    /* Tab styling */
    .card-header-tabs {
        margin-right: 0;
        margin-bottom: -1px;
        margin-left: 0;
    }

    .nav-tabs .nav-link {
        border: none;
        margin-bottom: 0;
        border-radius: 0;
        transition: all 0.3s ease;
        font-weight: 600;
        padding: 10px 20px;
        background-color: rgba(255, 255, 255, 0.8);
    }

    .nav-tabs .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.9);
        transform: translateY(-3px);
    }

    .nav-tabs .nav-link.active {
        background-color: #fff;
        color: var(--primary) !important;
        border-top: 3px solid var(--primary);
        border-bottom: none;
        position: relative;
    }

    [data-bs-theme="dark"] .nav-tabs .nav-link {
        background-color: rgba(57, 62, 70, 0.8);
        color: #eeeeee !important;
    }

    [data-bs-theme="dark"] .nav-tabs .nav-link:hover {
        background-color: rgba(57, 62, 70, 0.9);
    }

    [data-bs-theme="dark"] .nav-tabs .nav-link.active {
        background-color: #393E46;
        color: #00ADB5 !important;
        border-top: 3px solid #00ADB5;
    }

    .tab-content {
        padding-top: 1rem;
    }

    /* Masonry view for notes */
    .notes-masonry {
        column-count: 3;
        column-gap: 20px;
    }

    @media (max-width: 991px) {
        .notes-masonry {
            column-count: 2;
        }
    }

    @media (max-width: 767px) {
        .notes-masonry {
            column-count: 1;
        }
    }

    .masonry-note {
        break-inside: avoid;
        margin-bottom: 20px;
        position: relative;
        border-radius: 5px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

    .masonry-note:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        transform: translateY(-5px);
    }

    .masonry-note::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 28px;
        background: rgba(0, 0, 0, 0.1);
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
    }

    .masonry-note.is-pinned::after {
        content: '';
        position: absolute;
        top: -6px;
        left: 50%;
        transform: translateX(-50%);
        width: 12px;
        height: 12px;
        background-color: var(--danger);
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .masonry-note-content {
        padding: 15px;
    }

    /* Empty state */
    .empty-state {
        text-align: center;
        padding: 40px;
    }

    .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 20px;
        color: var(--text-secondary);
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h1>
                <i class="fas fa-sticky-note me-2"></i>
                Notes
            </h1>
            <p class="lead">Create and organize your quick notes</p>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <ul class="nav nav-tabs card-header-tabs" id="notesTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active text-dark" id="board-view-tab" data-bs-toggle="tab"
                                    data-bs-target="#board-view-tab-pane" type="button" role="tab"
                                    aria-controls="board-view-tab-pane" aria-selected="true">
                                <i class="fas fa-th me-1"></i> Board View
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-dark" id="list-view-tab" data-bs-toggle="tab"
                                    data-bs-target="#list-view-tab-pane" type="button" role="tab"
                                    aria-controls="list-view-tab-pane" aria-selected="false">
                                <i class="fas fa-list me-1"></i> List View
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-dark" id="add-note-tab" data-bs-toggle="tab"
                                    data-bs-target="#add-note-tab-pane" type="button" role="tab"
                                    aria-controls="add-note-tab-pane" aria-selected="false">
                                <i class="fas fa-plus-circle me-1"></i> Add New Note
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="notesTabsContent">
                        <!-- Board View Tab -->
                        <div class="tab-pane fade show active" id="board-view-tab-pane" role="tabpanel"
                             aria-labelledby="board-view-tab" tabindex="0">
                            <!-- Filter bar -->
                            <div class="filter-bar">
                                <div class="row">
                                    <div class="col-md-4 mb-2 mb-md-0">
                                        <label class="form-label mb-1">Filter by Tags</label>
                                        <div class="dropdown filter-dropdown">
                                            <button class="btn btn-outline-secondary dropdown-toggle w-100"
                                                    type="button" id="tagFilterDropdown" data-bs-toggle="dropdown"
                                                    aria-expanded="false">
                                                {% if current_tag %}{{ current_tag }}{% else %}All Tags{% endif %}
                                            </button>
                                            <ul class="dropdown-menu w-100" aria-labelledby="tagFilterDropdown">
                                                <li><a class="dropdown-item" href="{{ url_for('notes.notes') }}">All
                                                    Tags</a></li>
                                                {% for tag in tags %}
                                                <li><a class="dropdown-item"
                                                       href="{{ url_for('notes.notes', tag=tag, color=current_color, sort=current_sort) }}">{{
                                                    tag }}</a></li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-2 mb-md-0">
                                        <label class="form-label mb-1">Filter by Color</label>
                                        <div class="dropdown filter-dropdown">
                                            <button class="btn btn-outline-secondary dropdown-toggle w-100"
                                                    type="button" id="colorFilterDropdown" data-bs-toggle="dropdown"
                                                    aria-expanded="false">
                                                {% if current_color %}
                                                <div class="filter-option">
                                                    <div class="filter-color"
                                                         style="background-color: {{ current_color }}"></div>
                                                    <span>{{ current_color }}</span>
                                                </div>
                                                {% else %}
                                                All Colors
                                                {% endif %}
                                            </button>
                                            <ul class="dropdown-menu w-100" aria-labelledby="colorFilterDropdown">
                                                <li><a class="dropdown-item"
                                                       href="{{ url_for('notes.notes', tag=current_tag, sort=current_sort) }}">All
                                                    Colors</a></li>
                                                {% for color in colors %}
                                                <li>
                                                    <a class="dropdown-item"
                                                       href="{{ url_for('notes.notes', tag=current_tag, color=color, sort=current_sort) }}">
                                                        <div class="filter-option">
                                                            <div class="filter-color"
                                                                 style="background-color: {{ color }}"></div>
                                                            <span>{{ color }}</span>
                                                        </div>
                                                    </a>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label mb-1">Sort By</label>
                                        <div class="dropdown filter-dropdown">
                                            <button class="btn btn-outline-secondary dropdown-toggle w-100"
                                                    type="button" id="sortDropdown" data-bs-toggle="dropdown"
                                                    aria-expanded="false">
                                                {% if current_sort == 'created' %}
                                                Date Created
                                                {% elif current_sort == 'updated' %}
                                                Last Updated
                                                {% elif current_sort == 'pinned' %}
                                                Pinned First
                                                {% else %}
                                                Position
                                                {% endif %}
                                            </button>
                                            <ul class="dropdown-menu w-100" aria-labelledby="sortDropdown">
                                                <li><a class="dropdown-item"
                                                       href="{{ url_for('notes.notes', tag=current_tag, color=current_color, sort='position') }}">Position</a>
                                                </li>
                                                <li><a class="dropdown-item"
                                                       href="{{ url_for('notes.notes', tag=current_tag, color=current_color, sort='updated') }}">Last
                                                    Updated</a></li>
                                                <li><a class="dropdown-item"
                                                       href="{{ url_for('notes.notes', tag=current_tag, color=current_color, sort='created') }}">Date
                                                    Created</a></li>
                                                <li><a class="dropdown-item"
                                                       href="{{ url_for('notes.notes', tag=current_tag, color=current_color, sort='pinned') }}">Pinned
                                                    First</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Instructions -->
                            <div class="instructions">
                                <h5><i class="fas fa-info-circle me-2"></i>Instructions</h5>
                                <ul>
                                    <li>Drag notes around to organize them on the board</li>
                                    <li>Click on the edit button to modify note content</li>
                                    <li>Pin important notes for quick access</li>
                                    <li>Double-click on the notes board to create a note at that position</li>
                                    <li>Use tags to organize and filter your notes</li>
                                </ul>
                            </div>

                            <!-- Notes Board -->
                            <div class="notes-container" id="notesBoard" {% if not notes %}data-empty="true" {% endif
                                 %}>
                                <div class="notes-container-guide">
                                    <i class="fas fa-sticky-note guide-icon"></i>
                                    <span class="guide-text">Your notes will appear here</span>
                                    <p class="mt-2">Double-click anywhere to create a note</p>
                                </div>

                                {% for note in notes %}
                                <div class="sticky-note {% if note.is_pinned %}is-pinned{% endif %}"
                                     id="note-{{ note.id }}"
                                     style="background-color: {{ note.color }}; left: {{ note.position_x }}px; top: {{ note.position_y }}px; z-index: {{ note.z_index }};"
                                     data-id="{{ note.id }}">
                                    <div class="note-controls">
                                        <button class="note-btn pin-note" data-note-id="{{ note.id }}"
                                                title="{% if note.is_pinned %}Unpin{% else %}Pin{% endif %} note">
                                            <i class="fas {% if note.is_pinned %}fa-thumbtack{% else %}fa-thumbtack{% endif %}"></i>
                                        </button>
                                        <button class="note-btn front-note" data-note-id="{{ note.id }}"
                                                title="Bring to front">
                                            <i class="fas fa-arrow-up"></i>
                                        </button>
                                        <button class="note-btn edit-note" data-note-id="{{ note.id }}"
                                                title="Edit note">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="note-btn delete-note" data-note-id="{{ note.id }}"
                                                title="Delete note">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    {% if note.title %}
                                    <div class="note-title">{{ note.title }}</div>
                                    {% endif %}
                                    <div class="note-content">{{ note.content }}</div>

                                    {% if note.tags %}
                                    <div class="note-tags">
                                        {% for tag in note.tag_list %}
                                        <span class="note-tag" title="{{ tag }}">{{ tag }}</span>
                                        {% endfor %}
                                    </div>
                                    {% endif %}

                                    <div class="note-footer">
                                        <div class="note-timestamp">
                                            {{ note.updated_at.strftime('%Y-%m-%d %H:%M') }}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- List View Tab -->
                        <div class="tab-pane fade" id="list-view-tab-pane" role="tabpanel"
                             aria-labelledby="list-view-tab" tabindex="0">
                            <!-- Masonry Notes View -->
                            <div class="notes-masonry">
                                {% if notes %}
                                {% for note in notes %}
                                <div class="masonry-note {% if note.is_pinned %}is-pinned{% endif %}"
                                     style="background-color: {{ note.color }};" data-id="{{ note.id }}">
                                    <div class="masonry-note-content">
                                        <div class="note-controls">
                                            <button class="note-btn pin-note" data-note-id="{{ note.id }}"
                                                    title="{% if note.is_pinned %}Unpin{% else %}Pin{% endif %} note">
                                                <i class="fas {% if note.is_pinned %}fa-thumbtack{% else %}fa-thumbtack{% endif %}"></i>
                                            </button>
                                            <button class="note-btn edit-note" data-note-id="{{ note.id }}"
                                                    title="Edit note">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="note-btn delete-note" data-note-id="{{ note.id }}"
                                                    title="Delete note">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        {% if note.title %}
                                        <div class="note-title">{{ note.title }}</div>
                                        {% endif %}
                                        <div class="note-content">{{ note.content }}</div>

                                        {% if note.tags %}
                                        <div class="note-tags">
                                            {% for tag in note.tag_list %}
                                            <span class="note-tag" title="{{ tag }}">{{ tag }}</span>
                                            {% endfor %}
                                        </div>
                                        {% endif %}

                                        <div class="note-footer">
                                            <div class="note-timestamp">
                                                {{ note.updated_at.strftime('%Y-%m-%d %H:%M') }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                {% else %}
                                <div class="empty-state">
                                    <div class="empty-state-icon">
                                        <i class="fas fa-sticky-note"></i>
                                    </div>
                                    <h4>No notes found</h4>
                                    <p>Create your first note using the "Add New Note" tab</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Add New Note Tab -->
                        <div class="tab-pane fade" id="add-note-tab-pane" role="tabpanel" aria-labelledby="add-note-tab"
                             tabindex="0">
                            <h4 class="mb-4">
                                <i class="fas fa-plus-circle me-2"></i>
                                Create a New Note
                            </h4>
                            <div class="row">
                                <div class="col-lg-8 mx-auto">
                                    <form id="createNoteForm" method="POST" action="{{ url_for('notes.create_note') }}">
                                        <div class="mb-3">
                                            <label for="noteTitle" class="form-label">Title (Optional)</label>
                                            <input type="text" class="form-control" id="noteTitle" name="title"
                                                   placeholder="Note title">
                                        </div>
                                        <div class="mb-3">
                                            <label for="noteContent" class="form-label">Note Content</label>
                                            <textarea id="noteContent" name="content" class="form-control" rows="5"
                                                      placeholder="What's on your mind?"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="noteTags" class="form-label">Tags (Comma separated)</label>
                                            <input type="text" class="form-control" id="noteTags" name="tags"
                                                   placeholder="work, personal, important, etc.">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Choose Color</label>
                                            <div class="color-picker">
                                                <div class="color-option selected" style="background-color: #fff740;"
                                                     data-color="#fff740"></div>
                                                <div class="color-option" style="background-color: #ffd3b6;"
                                                     data-color="#ffd3b6"></div>
                                                <div class="color-option" style="background-color: #a8e6cf;"
                                                     data-color="#a8e6cf"></div>
                                                <div class="color-option" style="background-color: #dcedc1;"
                                                     data-color="#dcedc1"></div>
                                                <div class="color-option" style="background-color: #ff8b94;"
                                                     data-color="#ff8b94"></div>
                                                <div class="color-option" style="background-color: #f7d794;"
                                                     data-color="#f7d794"></div>
                                                <div class="color-option" style="background-color: #aee1f9;"
                                                     data-color="#aee1f9"></div>
                                                <div class="color-option" style="background-color: #f5b5fc;"
                                                     data-color="#f5b5fc"></div>
                                                <div class="color-option" style="background-color: #d9d9d9;"
                                                     data-color="#d9d9d9"></div>
                                            </div>
                                            <input type="hidden" id="noteColor" name="color" value="#fff740">
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="notePinned"
                                                   name="is_pinned">
                                            <label class="form-check-label" for="notePinned">Pin this note</label>
                                        </div>
                                        <div class="mb-3">
                                            <!-- Add randomized position inputs -->
                                            <input type="hidden" id="positionX" name="position_x" value="0">
                                            <input type="hidden" id="positionY" name="position_y" value="0">
                                        </div>
                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-plus me-1"></i>Add Note
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Note Modal -->
<div class="modal fade note-modal" id="editNoteModal" tabindex="-1" aria-labelledby="editNoteModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editNoteModalLabel">Edit Note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="editNoteTitle" class="form-label">Title (Optional)</label>
                    <input type="text" class="form-control" id="editNoteTitle" placeholder="Note title">
                </div>
                <div class="mb-3">
                    <label for="editNoteContent" class="form-label">Content</label>
                    <textarea id="editNoteContent" class="form-control" rows="6"></textarea>
                </div>
                <div class="mb-3">
                    <label for="editNoteTags" class="form-label">Tags (Comma separated)</label>
                    <input type="text" class="form-control" id="editNoteTags"
                           placeholder="work, personal, important, etc.">
                </div>
                <div class="mb-3">
                    <label class="form-label">Note Color</label>
                    <div class="color-picker edit-color-picker">
                        <div class="color-option" style="background-color: #fff740;" data-color="#fff740"></div>
                        <div class="color-option" style="background-color: #ffd3b6;" data-color="#ffd3b6"></div>
                        <div class="color-option" style="background-color: #a8e6cf;" data-color="#a8e6cf"></div>
                        <div class="color-option" style="background-color: #dcedc1;" data-color="#dcedc1"></div>
                        <div class="color-option" style="background-color: #ff8b94;" data-color="#ff8b94"></div>
                        <div class="color-option" style="background-color: #f7d794;" data-color="#f7d794"></div>
                        <div class="color-option" style="background-color: #aee1f9;" data-color="#aee1f9"></div>
                        <div class="color-option" style="background-color: #f5b5fc;" data-color="#f5b5fc"></div>
                        <div class="color-option" style="background-color: #d9d9d9;" data-color="#d9d9d9"></div>
                    </div>
                    <input type="hidden" id="editNoteColor" value="#fff740">
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="editNotePinned">
                    <label class="form-check-label" for="editNotePinned">Pin this note</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveNoteChanges">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Note Confirmation Modal -->
<div class="modal fade" id="deleteNoteModal" tabindex="-1" aria-labelledby="deleteNoteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteNoteModalLabel">Delete Note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this note? This action cannot be undone.</p>
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    This note will be permanently deleted!
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteNote">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.10.11/interact.min.js"></script>
<script>
    // Set random initial positions when the form loads
    document.addEventListener('DOMContentLoaded', function () {
        const createNoteForm = document.getElementById('createNoteForm');
        if (createNoteForm) {
            createNoteForm.addEventListener('submit', function () {
                // Get board dimensions
                const notesBoard = document.getElementById('notesBoard');
                const maxX = notesBoard ? notesBoard.clientWidth - 240 : 500;
                const maxY = notesBoard ? notesBoard.clientHeight - 240 : 400;

                // Set random positions
                document.getElementById('positionX').value = Math.max(20, Math.min(maxX - 20, Math.floor(maxX / 2 + (Math.random() * 100 - 50))));
                document.getElementById('positionY').value = Math.max(20, Math.min(maxY - 20, Math.floor(maxY / 2 + (Math.random() * 100 - 50))));
            });
        }
    });
</script>
<script src="{{ url_for('static', filename='js/notes.js') }}"></script>
{% endblock %}