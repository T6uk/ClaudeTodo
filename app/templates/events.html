{% extends 'base.html' %}

{% block title %}Events Calendar - TaskMaster App{% endblock %}

{% block content %}
<div class="page-title">
    <h1>Calendar</h1>
    <a href="{{ url_for('main.create_event') }}" class="btn btn-primary">Create Event</a>
</div>

<div class="calendar-container">
    <div class="calendar-header">
        <div class="calendar-nav">
            <a href="{{ url_for('main.events', date=prev_month.strftime('%Y-%m-%d')) }}" class="btn btn-secondary btn-icon">
                <i>◀</i>
            </a>
            <div class="calendar-title">
                {{ month_name }} {{ current_date.year }}
            </div>
            <a href="{{ url_for('main.events', date=next_month.strftime('%Y-%m-%d')) }}" class="btn btn-secondary btn-icon">
                <i>▶</i>
            </a>
        </div>
        <div class="calendar-views">
            <a href="{{ url_for('main.events', view='month', date=current_date.strftime('%Y-%m-%d')) }}" class="view-btn active">Month</a>
            <a href="{{ url_for('main.events', view='week', date=current_date.strftime('%Y-%m-%d')) }}" class="view-btn">Week</a>
            <a href="{{ url_for('main.events', view='day', date=current_date.strftime('%Y-%m-%d')) }}" class="view-btn">Day</a>
        </div>
    </div>

    <table class="calendar">
        <thead>
            <tr>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
                <th>Sun</th>
            </tr>
        </thead>
        <tbody>
            {% for week in calendar %}
            <tr>
                {% for day in week %}
                {% if day != 0 %}
                {% set current_day = current_date.replace(day=day) %}
                <td {% if current_day == today %}class="today"{% endif %}>
                    <div class="day-number">{{ day }}</div>
                    <div class="events">
                        {% for event in events %}
                            {% if event.start_datetime.day == day %}
                            <a href="{{ url_for('main.event_detail', id=event.id) }}" class="calendar-event event-{{ event.color }}">
                                {% if event.all_day %}All day: {% endif %}
                                {{ event.title }}
                            </a>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <a href="{{ url_for('main.create_event', date=current_day.strftime('%Y-%m-%d')) }}" class="add-event-btn">+</a>
                </td>
                {% else %}
                <td class="empty-day"></td>
                {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}